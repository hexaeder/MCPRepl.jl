#!/usr/bin/env bash

# Start Julia REPL with MCPRepl project and auto-load startup script
# This script launches Julia in the project and loads the recommended startup
# script. Environment configuration is expected to be stored in project
# configuration (.mcprepl/security.json) or a project .env file managed by
# the project tools â€” the launcher intentionally does not alter environment
# variables.

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Parse options
SUPERVISOR_MODE=false
JULIA_ARGS=()

while [[ $# -gt 0 ]]; do
  case $1 in
    --supervisor)
      SUPERVISOR_MODE=true
      shift
      ;;
    *)
      JULIA_ARGS+=("$1")
      shift
      ;;
  esac
done

# Export supervisor flag for Julia startup script
export JULIA_MCP_SUPERVISOR="$SUPERVISOR_MODE"

echo "Starting Julia REPL with MCPRepl project..."
if [ "$SUPERVISOR_MODE" = true ]; then
  echo "  Supervisor mode: enabled"
fi
echo ""

exec julia --project="$SCRIPT_DIR" --load="$SCRIPT_DIR/.julia-startup.jl" "${JULIA_ARGS[@]}"
